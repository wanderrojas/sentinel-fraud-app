<div class="card flex justify-center" *ngIf="selectedCase">
  <p-accordion value="1">
    <!-- Datos de la transacción -->
    <p-accordion-panel value="0">
      <p-accordion-header class="header-transaccion"
        >Datos de la transacción</p-accordion-header
      >
      <p-accordion-content classss="bg-transaccion p-2 rounded-md">
        <app-transaction-detail
          [transactionId]="selectedCase.transaction.transaction_id"
        ></app-transaction-detail>
      </p-accordion-content>
    </p-accordion-panel>

    <!-- Datos del caso -->
    <p-accordion-panel value="1">
      <p-accordion-header class="header-transaccion"
        >Datos del caso</p-accordion-header
      >
      <p-accordion-content class="bg-caso p-1 rounded-md">
        <div class="process-analyze card grid gap-0 mb-5">
          <div class="col-12 lg:col-9">
            @if(selectedCase){

            <p-card header="Datos del caso">
              <p-dataView [value]="[selectedCase]" layout="list">
                <ng-template #list let-items>
                  <div *ngFor="let tx of items" class="grid gap-2">
                    <div class="col-12"><b>ID Caso:</b> {{ tx?.case_id }}</div>
                    <div class="col-12">
                      <b>ID Transacción:</b>
                      {{ tx?.transaction.transaction_id }}
                    </div>
                    <div class="col-12">
                      <b class="mr-2">Recomendación:</b>
                      <p-tag
                        [value]="tx?.decision_recommendation"
                        [severity]="
                          getDecisionSeverity(tx?.decision_recommendation)
                        "
                      >
                      </p-tag>
                    </div>
                    <div class="col-12">
                      <b>Confianza:</b>
                      <span class="ml-3 font-bold"
                        >{{ (tx.confidence * 100).toFixed(0) }}%</span
                      >
                    </div>
                    <div class="col-12">
                      <b class="mr-2">Creado:</b>
                      {{ tx?.created_at | date : "medium" }}
                    </div>
                    <div class="col-12">
                      <b class="mr-2">Status:</b>
                      <p-tag
                        [value]="tx?.status"
                        [severity]="getStatusSeverity(tx?.status)"
                      >
                      </p-tag>
                    </div>
                  </div>
                </ng-template>
              </p-dataView>
            </p-card>
            }
          </div>

          <div
            class="col-12 lg:col-3 p-3 action-decisionss surface-100 border-round"
          >
            @if(selectedCase.status==='PENDING'){
            <div>
              <h3>Ación a realizar</h3>
              <form [formGroup]="reviewForm" (ngSubmit)="confirmReview()">
                <div class="flex flex-column gap-3">
                  <div>
                    <h4 class="font-bold mb-2">Decisión(*):</h4>
                    <p-select
                      [options]="reviewOptions"
                      formControlName="decision"
                      optionLabel="label"
                      optionValue="value"
                      id="decision"
                      [invalid]="isInvalid('decision')"
                      placeholder="Seleccionar decisión"
                      class="w-full md:w-56"
                    ></p-select>
                    <p-message
                      *ngIf="isInvalid('decision')"
                      severity="error"
                      size="small"
                      variant="simple"
                    >
                      Seleccione una decisión.
                    </p-message>
                  </div>
                  <!-- pInputTextarea -->
                  <div>
                    <h4 class="font-bold mb-2">Notas:</h4>
                    <textarea
                      id="notes"
                      formControlName="notes"
                      rows="5"
                      placeholder="Escribir notas de la revisión..."
                      class="w-full"
                    ></textarea>
                  </div>
                </div>

                <div
                  class="flex justify-content-center mt-4 border-top-1 w-full text-center pt-4 border-cyan-50 mb-2"
                >
                  <p-button
                    label="Confirmar Revisión"
                    icon="pi pi-check"
                    class=""
                    type="submit"
                  ></p-button>
                </div>
              </form>
            </div>
            }@else {
            <h3>Ación realizada</h3>

            <div class="col-12">
              <b>Desición:</b><br />
              <p-tag
                [value]="selectedCase.status"
                [severity]="getStatusSeverity(selectedCase.status)"
              >
              </p-tag>
            </div>
            <div class="col-12">
              <b>Revisado por:</b>
              {{ selectedCase.reviewer_id }}
            </div>
            <div class="col-12">
              <b>Nota:</b><br />
              {{ selectedCase.reviewer_notes }}
            </div>

            <div class="col-12">
              <b>Fecha de revición:</b> <br />
              {{ selectedCase.reviewed_at | date : "medium" }}
            </div>
            }
          </div>
        </div>
      </p-accordion-content>
    </p-accordion-panel>
  </p-accordion>
</div>
